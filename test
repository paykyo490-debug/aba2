<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABA æ”¯ä»˜æ¸¬è©¦</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .payment-container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        
        .order-info {
            border-bottom: 1px solid #eee;
            padding-bottom: 16px;
            margin-bottom: 16px;
        }
        
        .order-info h3 {
            color: #333;
            margin-bottom: 12px;
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            color: #666;
        }
        
        .total-amount {
            display: flex;
            justify-content: space-between;
            font-size: 20px;
            font-weight: bold;
            color: #e63946;
            margin: 16px 0;
        }
        
        .payment-button {
            width: 100%;
            padding: 16px;
            background: #0066cc;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 12px;
        }
        
        .payment-button:active {
            background: #0052a3;
        }
        
        .payment-button.aba {
            background: #0066cc;
        }
        
        .payment-button.qr {
            background: #52b788;
        }
        
        .status-message {
            text-align: center;
            padding: 12px;
            border-radius: 6px;
            margin-top: 12px;
            display: none;
        }
        
        .status-message.success {
            background: #d4edda;
            color: #155724;
            display: block;
        }
        
        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            display: block;
        }
        
        .status-message.info {
            background: #d1ecf1;
            color: #0c5460;
            display: block;
        }
        
        .test-options {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 2px dashed #ddd;
        }
        
        .test-options h4 {
            color: #666;
            margin-bottom: 12px;
            font-size: 14px;
        }
        
        .test-button {
            width: 100%;
            padding: 12px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            margin-bottom: 8px;
        }
        
        .log-area {
            margin-top: 16px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 12px;
            color: #495057;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="payment-container">
        <!-- è¨‚å–®è³‡è¨Š -->
        <div class="order-info">
            <h3>è¨‚å–®è³‡è¨Š</h3>
            <div class="order-item">
                <span>è¨‚å–®è™Ÿ:</span>
                <span id="orderId">ORDER20241203001</span>
            </div>
            <div class="order-item">
                <span>å•†å“:</span>
                <span>éŠæˆ²å„²å€¼</span>
            </div>
            <div class="total-amount">
                <span>æ”¯ä»˜é‡‘é¡:</span>
                <span id="amount">$10.00 USD</span>
            </div>
        </div>

        <!-- æ”¯ä»˜æŒ‰éˆ• -->
        <button class="payment-button aba" onclick="payWithABAApp()">
            ğŸ¦ ä½¿ç”¨ ABA Mobile æ”¯ä»˜
        </button>

        <button class="payment-button qr" onclick="payWithQR()">
            ğŸ“± é¡¯ç¤º QR Code æ”¯ä»˜
        </button>

        <!-- ç‹€æ…‹è¨Šæ¯ -->
        <div id="statusMessage" class="status-message"></div>

        <!-- æ¸¬è©¦é¸é … -->
        <div class="test-options">
            <h4>ğŸ§ª æ¸¬è©¦é¸é … (é–‹ç™¼ç”¨)</h4>
            
            <button class="test-button" onclick="testScheme1()">
                æ¸¬è©¦ 1: abamobilebank://
            </button>
            
            <button class="test-button" onclick="testScheme2()">
                æ¸¬è©¦ 2: aba://
            </button>
            
            <button class="test-button" onclick="testScheme3()">
                æ¸¬è©¦ 3: intent:// (Android)
            </button>
            
            <button class="test-button" onclick="testUniversalLink()">
                æ¸¬è©¦ 4: Universal Link
            </button>
            
            <button class="test-button" onclick="detectEnvironment()">
                æª¢æ¸¬ç•¶å‰ç’°å¢ƒ
            </button>

            <!-- æ—¥èªŒå€åŸŸ -->
            <div id="logArea" class="log-area"></div>
        </div>
    </div>

    <script>
        // æ—¥èªŒå‡½æ•¸
        function log(message) {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            logArea.innerHTML += `[${timestamp}] ${message}<br>`;
            logArea.scrollTop = logArea.scrollHeight;
            console.log(message);
        }

        // é¡¯ç¤ºç‹€æ…‹è¨Šæ¯
        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message ${type}`;
            
            if (type !== 'error') {
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 5000);
            }
        }

        // æª¢æ¸¬ç’°å¢ƒ
        function detectEnvironment() {
            const ua = navigator.userAgent.toLowerCase();
            let env = 'ç€è¦½å™¨: ';
            
            if (ua.indexOf('micromessenger') > -1) {
                env += 'WeChat';
            } else if (ua.indexOf('line') > -1) {
                env += 'Line';
            } else if (ua.indexOf('fbav') > -1 || ua.indexOf('fban') > -1) {
                env += 'Facebook';
            } else if (ua.indexOf('instagram') > -1) {
                env += 'Instagram';
            } else if (ua.indexOf('chrome') > -1) {
                env += 'Chrome';
            } else if (ua.indexOf('safari') > -1) {
                env += 'Safari';
            } else {
                env += 'Unknown';
            }
            
            const os = /android/i.test(ua) ? 'Android' : /iphone|ipad|ipod/i.test(ua) ? 'iOS' : 'Unknown';
            
            log(`ç’°å¢ƒ: ${env}, ç³»çµ±: ${os}`);
            log(`User Agent: ${navigator.userAgent}`);
            showStatus(`${env} / ${os}`, 'info');
        }

        // ä¸»è¦æ”¯ä»˜å‡½æ•¸ - æ™ºèƒ½ Deep Link
        function payWithABAApp() {
            log('é–‹å§‹ ABA Mobile æ”¯ä»˜æµç¨‹');
            showStatus('æ­£åœ¨æ‰“é–‹ ABA Mobile...', 'info');
            
            const orderId = document.getElementById('orderId').textContent;
            const amount = '10.00';
            
            // æª¢æ¸¬ç’°å¢ƒ
            const ua = navigator.userAgent.toLowerCase();
            const isWeChat = ua.indexOf('micromessenger') > -1;
            const isAndroid = /android/i.test(ua);
            const isIOS = /iphone|ipad|ipod/i.test(ua);
            
            // WeChat ç’°å¢ƒéœ€è¦ç‰¹æ®Šè™•ç†
            if (isWeChat) {
                log('æª¢æ¸¬åˆ° WeChat ç’°å¢ƒ');
                showStatus('è«‹é»æ“Šå³ä¸Šè§’ã€Œ...ã€åœ¨ç€è¦½å™¨ä¸­æ‰“é–‹', 'error');
                return;
            }
            
            // æ§‹å»º deep link (å¾æœå°‹çµæœå¾—çŸ¥çš„æ ¼å¼)
            const deepLink = `abamobilebank://ababank.com?order=${orderId}&amount=${amount}`;
            
            log(`Deep Link: ${deepLink}`);
            
            // å˜—è©¦æ‰“é–‹ app
            const startTime = Date.now();
            window.location.href = deepLink;
            
            // Fallback è™•ç†
            setTimeout(() => {
                const timeElapsed = Date.now() - startTime;
                
                // å¦‚æœé é¢é‚„åœ¨,èªªæ˜ app æ²’æœ‰æ‰“é–‹
                if (document.hidden || timeElapsed > 2000) {
                    log('App å·²æ‰“é–‹æˆ–é é¢å·²åˆ‡æ›');
                    return;
                }
                
                log('App æœªå®‰è£,æº–å‚™è·³è½‰ä¸‹è¼‰é ');
                
                // App æ²’æœ‰å®‰è£,è·³è½‰åˆ°ä¸‹è¼‰é 
                if (isAndroid) {
                    showStatus('æœªæª¢æ¸¬åˆ° ABA Mobile,è·³è½‰è‡³ Play Store', 'error');
                    setTimeout(() => {
                        window.location.href = 'https://play.google.com/store/apps/details?id=com.paygo24.ibank';
                    }, 1500);
                } else if (isIOS) {
                    showStatus('æœªæª¢æ¸¬åˆ° ABA Mobile,è·³è½‰è‡³ App Store', 'error');
                    setTimeout(() => {
                        window.location.href = 'https://apps.apple.com/app/aba-mobile/id1458182842';
                    }, 1500);
                }
            }, 1500);
        }

        // QR Code æ”¯ä»˜
        function payWithQR() {
            log('é¸æ“‡ QR Code æ”¯ä»˜æ–¹å¼');
            showStatus('QR Code æ”¯ä»˜åŠŸèƒ½é–‹ç™¼ä¸­...', 'info');
            
            // é€™è£¡æ‡‰è©²èª¿ç”¨å¾Œç«¯ API ç”Ÿæˆ KHQR
            // ç„¶å¾Œé¡¯ç¤º QR code è®“ç”¨æˆ¶æƒæ
            alert('QR Code æ”¯ä»˜åŠŸèƒ½éœ€è¦å°æ¥ PayWay QR API\nè«‹å…ˆç”³è«‹ PayWay å•†æˆ¶å¸³è™Ÿ');
        }

        // æ¸¬è©¦æ–¹æ¡ˆ 1: æ¨™æº– deep link
        function testScheme1() {
            const scheme = 'abamobilebank://ababank.com';
            log(`æ¸¬è©¦ Scheme 1: ${scheme}`);
            window.location.href = scheme;
            showStatus('å·²å˜—è©¦æ‰“é–‹ abamobilebank://', 'info');
        }

        // æ¸¬è©¦æ–¹æ¡ˆ 2: ç°¡çŸ­ scheme
        function testScheme2() {
            const scheme = 'aba://open';
            log(`æ¸¬è©¦ Scheme 2: ${scheme}`);
            window.location.href = scheme;
            showStatus('å·²å˜—è©¦æ‰“é–‹ aba://', 'info');
        }

        // æ¸¬è©¦æ–¹æ¡ˆ 3: Android Intent
        function testScheme3() {
            const intent = 'intent://ababank.com#Intent;scheme=abamobilebank;package=com.paygo24.ibank;end';
            log(`æ¸¬è©¦ Android Intent: ${intent}`);
            window.location.href = intent;
            showStatus('å·²å˜—è©¦ Android Intent', 'info');
        }

        // æ¸¬è©¦æ–¹æ¡ˆ 4: Universal Link (å¦‚æœ ABA æœ‰æä¾›)
        function testUniversalLink() {
            const link = 'https://aba.com.kh/app/payment';
            log(`æ¸¬è©¦ Universal Link: ${link}`);
            window.location.href = link;
            showStatus('å·²å˜—è©¦ Universal Link', 'info');
        }

        // é é¢è¼‰å…¥æ™‚æª¢æ¸¬ç’°å¢ƒ
        window.onload = function() {
            log('é é¢è¼‰å…¥å®Œæˆ');
            detectEnvironment();
        };

        // ç›£è½é é¢å¯è¦‹æ€§è®ŠåŒ–
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                log('é é¢å·²éš±è— (App å¯èƒ½å·²æ‰“é–‹)');
            } else {
                log('é é¢é‡æ–°å¯è¦‹');
            }
        });
    </script>
</body>
</html>
